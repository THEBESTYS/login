<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ë¡œê·¸ì¸ ì‹œìŠ¤í…œ - ìµœì¢… ë²„ì „</title>
    <style>
        body { 
            font-family: Arial; 
            max-width: 400px; 
            margin: 50px auto; 
            padding: 20px; 
        }
        .tabs { display: flex; margin-bottom: 20px; }
        .tab { 
            flex: 1; 
            padding: 10px; 
            border: none; 
            background: #eee; 
            cursor: pointer; 
        }
        .tab.active { background: #007bff; color: white; }
        .panel { 
            padding: 20px; 
            border: 1px solid #ddd; 
            border-radius: 5px; 
            display: none; 
        }
        .panel.active { display: block; }
        input { 
            width: 100%; 
            padding: 10px; 
            margin: 10px 0; 
            border: 1px solid #ddd; 
            border-radius: 4px; 
        }
        button { 
            width: 100%; 
            padding: 12px; 
            background: #28a745; 
            color: white; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            margin-top: 10px; 
        }
        .message { 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 4px; 
            display: none; 
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
    
    <!-- í•µì‹¬: ì—¬ê¸°ì— Firebase ëª¨ì˜ ê°ì²´ë¥¼ ë¨¼ì € ì •ì˜ -->
    <script>
        // ====== FIREBASE ëª¨ì˜ ê°ì²´ ======
        console.log("ğŸ”§ Firebase ëª¨ì˜ ê°ì²´ ìƒì„± ì‹œì‘");
        
        // ì „ì—­ firebase ê°ì²´ ìƒì„±
        window.firebase = {
            // ê¸°ë³¸ ì†ì„±
            apps: [],
            _initialized: false,
            
            // ì´ˆê¸°í™” í•¨ìˆ˜
            initializeApp: function(config) {
                console.log("ğŸ”¥ Firebase ì´ˆê¸°í™” í˜¸ì¶œ:", config.projectId);
                this.apps.push({
                    name: '[DEFAULT]',
                    options: config,
                    _initialized: true
                });
                this._initialized = true;
                console.log("âœ… Firebase ì´ˆê¸°í™” ì™„ë£Œ");
                return this.apps[0];
            },
            
            // ì¸ì¦ ì„œë¹„ìŠ¤
            auth: function() {
                console.log("ğŸ” Auth ì„œë¹„ìŠ¤ ìƒì„±");
                return {
                    createUserWithEmailAndPassword: function(email, password) {
                        console.log("ğŸ“ íšŒì›ê°€ì… ì‹œë®¬ë ˆì´ì…˜:", email);
                        return new Promise((resolve, reject) => {
                            // 2ì´ˆ í›„ ì„±ê³µ ì‹œë®¬ë ˆì´ì…˜
                            setTimeout(() => {
                                console.log("âœ… ëª¨ì˜ íšŒì›ê°€ì… ì„±ê³µ");
                                resolve({
                                    user: {
                                        uid: 'mock-uid-' + Date.now(),
                                        email: email,
                                        displayName: email.split('@')[0]
                                    }
                                });
                            }, 2000);
                        });
                    },
                    
                    signInWithEmailAndPassword: function(email, password) {
                        console.log("ğŸ”‘ ë¡œê·¸ì¸ ì‹œë®¬ë ˆì´ì…˜:", email);
                        return new Promise((resolve, reject) => {
                            setTimeout(() => {
                                console.log("âœ… ëª¨ì˜ ë¡œê·¸ì¸ ì„±ê³µ");
                                resolve({
                                    user: {
                                        uid: 'mock-user-001',
                                        email: email
                                    }
                                });
                            }, 2000);
                        });
                    }
                };
            },
            
            // Firestore ì„œë¹„ìŠ¤
            firestore: function() {
                console.log("ğŸ—„ï¸ Firestore ì„œë¹„ìŠ¤ ìƒì„±");
                return {
                    collection: function(collectionName) {
                        return {
                            doc: function(docId) {
                                return {
                                    set: function(data) {
                                        console.log("ğŸ’¾ Firestore ì €ì¥ ì‹œë®¬ë ˆì´ì…˜:", collectionName, docId, data);
                                        return new Promise((resolve) => {
                                            setTimeout(() => {
                                                console.log("âœ… ëª¨ì˜ Firestore ì €ì¥ ì™„ë£Œ");
                                                resolve();
                                            }, 1500);
                                        });
                                    },
                                    update: function(data) {
                                        console.log("ğŸ“ Firestore ì—…ë°ì´íŠ¸:", data);
                                        return Promise.resolve();
                                    }
                                };
                            }
                        };
                    }
                };
            }
        };
        
        console.log("âœ… Firebase ëª¨ì˜ ê°ì²´ ìƒì„± ì™„ë£Œ");
        console.log("window.firebase:", window.firebase);
    </script>
</head>
<body>
    <h1>ë¡œê·¸ì¸ ì‹œìŠ¤í…œ (ëª¨ì˜ Firebase)</h1>
    
    <div class="tabs">
        <button class="tab active" onclick="showPanel('login')">ë¡œê·¸ì¸</button>
        <button class="tab" onclick="showPanel('signup')">íšŒì›ê°€ì…</button>
    </div>
    
    <!-- ë¡œê·¸ì¸ íŒ¨ë„ -->
    <div id="login-panel" class="panel active">
        <h2>ë¡œê·¸ì¸</h2>
        <div id="login-message" class="message"></div>
        <input type="email" id="login-email" placeholder="ì´ë©”ì¼">
        <input type="password" id="login-password" placeholder="ë¹„ë°€ë²ˆí˜¸">
        <button onclick="handleLogin()">ë¡œê·¸ì¸</button>
    </div>
    
    <!-- íšŒì›ê°€ì… íŒ¨ë„ -->
    <div id="signup-panel" class="panel">
        <h2>íšŒì›ê°€ì…</h2>
        <div id="signup-message" class="message"></div>
        <input type="email" id="signup-email" placeholder="ì´ë©”ì¼">
        <input type="text" id="signup-name" placeholder="ì´ë¦„">
        <input type="password" id="signup-password" placeholder="ë¹„ë°€ë²ˆí˜¸ (6ì ì´ìƒ)">
        <input type="password" id="signup-confirm" placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸">
        <button onclick="handleSignup()">íšŒì›ê°€ì…</button>
    </div>
    
    <!-- í…ŒìŠ¤íŠ¸ ì˜ì—­ -->
    <div style="margin-top: 30px; padding: 15px; background: #f8f9fa; border-radius: 5px;">
        <h3>ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</h3>
        <button onclick="testFirebaseObject()" style="background: #6c757d;">Firebase ê°ì²´ í…ŒìŠ¤íŠ¸</button>
        <button onclick="testTabSwitching()" style="background: #17a2b8;">íƒ­ ì „í™˜ í…ŒìŠ¤íŠ¸</button>
        <button onclick="showConsoleInfo()" style="background: #343a40;">ì½˜ì†” ì •ë³´</button>
    </div>

    <script>
        // ====== Firebase ì„¤ì • ======
        const firebaseConfig = {
            apiKey: "AIzaSyC1XDqgki7lKMz-EE4ZFzOLmku8EsLI0yI",
            authDomain: "login-57c14.firebaseapp.com",
            projectId: "login-57c14",
            storageBucket: "login-57c14.firebasestorage.app",
            messagingSenderId: "847658526472",
            appId: "1:847658526472:web:05adaddfea3afff8e12ebd"
        };
        
        // ====== UI í•¨ìˆ˜ ======
        function showPanel(panelName) {
            console.log("ì „í™˜í•  íŒ¨ë„:", panelName);
            
            // ëª¨ë“  íƒ­ ë¹„í™œì„±í™”
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // ì„ íƒí•œ íƒ­ í™œì„±í™”
            document.querySelector(`.tab[onclick="showPanel('${panelName}')"]`).classList.add('active');
            
            // ëª¨ë“  íŒ¨ë„ ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.panel').forEach(panel => {
                panel.classList.remove('active');
            });
            
            // ì„ íƒí•œ íŒ¨ë„ í‘œì‹œ
            document.getElementById(panelName + '-panel').classList.add('active');
            
            console.log("íŒ¨ë„ ì „í™˜ ì™„ë£Œ:", panelName);
        }
        
        function showMessage(panel, message, type) {
            const messageEl = document.getElementById(panel + '-message');
            messageEl.textContent = message;
            messageEl.className = 'message ' + type;
            messageEl.style.display = 'block';
            
            if (type === 'success' || type === 'error') {
                setTimeout(() => {
                    messageEl.style.display = 'none';
                }, 5000);
            }
        }
        
        // ====== íšŒì›ê°€ì… í•¨ìˆ˜ ======
        async function handleSignup() {
            console.log("=== íšŒì›ê°€ì… ì‹œì‘ ===");
            
            // ê°’ ê°€ì ¸ì˜¤ê¸°
            const email = document.getElementById('signup-email').value.trim();
            const name = document.getElementById('signup-name').value.trim();
            const password = document.getElementById('signup-password').value;
            const confirm = document.getElementById('signup-confirm').value;
            
            // ìœ íš¨ì„± ê²€ì‚¬
            if (!email || !name || !password || !confirm) {
                showMessage('signup', 'ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            if (password !== confirm) {
                showMessage('signup', 'ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            
            if (password.length < 6) {
                showMessage('signup', 'ë¹„ë°€ë²ˆí˜¸ëŠ” 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.', 'error');
                return;
            }
            
            // ë²„íŠ¼ ìƒíƒœ ë³€ê²½
            const btn = document.querySelector('#signup-panel button');
            const originalText = btn.textContent;
            btn.disabled = true;
            btn.textContent = 'ê°€ì… ì²˜ë¦¬ ì¤‘...';
            
            try {
                // Firebase ê°ì²´ í™•ì¸
                if (typeof firebase === 'undefined') {
                    throw new Error('Firebase ê°ì²´ê°€ ì—†ìŠµë‹ˆë‹¤.');
                }
                
                console.log("1. Firebase ê°ì²´ í™•ì¸ë¨");
                
                // Firebase ì´ˆê¸°í™”
                const app = firebase.initializeApp(firebaseConfig);
                console.log("2. Firebase ì´ˆê¸°í™” ì™„ë£Œ:", app.options.projectId);
                
                const auth = firebase.auth();
                const db = firebase.firestore();
                console.log("3. ì„œë¹„ìŠ¤ ê°ì²´ ìƒì„± ì™„ë£Œ");
                
                // ëª¨ì˜ íšŒì›ê°€ì… ì‹¤í–‰
                showMessage('signup', 'íšŒì›ê°€ì… ì²˜ë¦¬ ì¤‘...', 'success');
                
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                console.log("4. ì‚¬ìš©ì ìƒì„± ì™„ë£Œ:", user.uid);
                
                // Firestoreì— ì €ì¥
                const userData = {
                    uid: user.uid,
                    email: email,
                    displayName: name,
                    tier: 'bronze',
                    points: 1000,
                    status: 'active',
                    signupMethod: 'email',
                    createdAt: new Date().toISOString(),
                    lastLogin: new Date().toISOString()
                };
                
                await db.collection('ashop_users').doc(user.uid).set(userData);
                console.log("5. Firestore ì €ì¥ ì™„ë£Œ");
                
                // ì„±ê³µ ë©”ì‹œì§€
                showMessage('signup', `ğŸ‰ ${name}ë‹˜, íšŒì›ê°€ì… ì™„ë£Œ! (ëª¨ì˜ ë°ì´í„°)`, 'success');
                
                // í¼ ì´ˆê¸°í™”
                document.getElementById('signup-email').value = '';
                document.getElementById('signup-name').value = '';
                document.getElementById('signup-password').value = '';
                document.getElementById('signup-confirm').value = '';
                
                // ë¡œê·¸ì¸ íƒ­ìœ¼ë¡œ ì „í™˜
                setTimeout(() => {
                    showPanel('login');
                    document.getElementById('login-email').value = email;
                    showMessage('login', `${name}ë‹˜, ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”!`, 'success');
                }, 2000);
                
            } catch (error) {
                console.error("íšŒì›ê°€ì… ì—ëŸ¬:", error);
                showMessage('signup', `ì—ëŸ¬: ${error.message}`, 'error');
                
            } finally {
                // ë²„íŠ¼ ë³µì›
                btn.disabled = false;
                btn.textContent = originalText;
            }
        }
        
        // ====== ë¡œê·¸ì¸ í•¨ìˆ˜ ======
        async function handleLogin() {
            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value;
            
            if (!email || !password) {
                showMessage('login', 'ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            const btn = document.querySelector('#login-panel button');
            const originalText = btn.textContent;
            btn.disabled = true;
            btn.textContent = 'ë¡œê·¸ì¸ ì¤‘...';
            
            try {
                if (typeof firebase === 'undefined') {
                    throw new Error('Firebase ê°ì²´ê°€ ì—†ìŠµë‹ˆë‹¤.');
                }
                
                const auth = firebase.auth();
                showMessage('login', 'ë¡œê·¸ì¸ ì²˜ë¦¬ ì¤‘...', 'success');
                
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                
                showMessage('login', `âœ… ${email}ë‹˜, ë¡œê·¸ì¸ ì„±ê³µ! (ëª¨ì˜ ë°ì´í„°)`, 'success');
                
                // í™ˆí˜ì´ì§€ë¡œ ì´ë™ ì‹œë®¬ë ˆì´ì…˜
                setTimeout(() => {
                    showMessage('login', 'í™ˆí˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤...', 'success');
                }, 1500);
                
            } catch (error) {
                console.error("ë¡œê·¸ì¸ ì—ëŸ¬:", error);
                showMessage('login', `ë¡œê·¸ì¸ ì‹¤íŒ¨: ${error.message}`, 'error');
                
            } finally {
                setTimeout(() => {
                    btn.disabled = false;
                    btn.textContent = originalText;
                }, 2000);
            }
        }
        
        // ====== í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ ======
        function testFirebaseObject() {
            console.log("=== Firebase ê°ì²´ í…ŒìŠ¤íŠ¸ ===");
            console.log("1. firebase íƒ€ì…:", typeof firebase);
            console.log("2. firebase ë‚´ìš©:", firebase);
            console.log("3. window.firebase:", window.firebase);
            
            if (typeof firebase !== 'undefined') {
                alert(`âœ… Firebase ê°ì²´ ìˆìŒ!\n\napps ê°œìˆ˜: ${firebase.apps.length}\nì´ˆê¸°í™”ë¨: ${firebase._initialized || 'false'}`);
            } else {
                alert("âŒ Firebase ê°ì²´ ì—†ìŒ\n\nwindow ê°ì²´ì—ì„œ í™•ì¸ ì¤‘...");
                console.log("ì „ì—­ window ê°ì²´:", Object.keys(window));
            }
        }
        
        function testTabSwitching() {
            const currentTab = document.querySelector('.tab.active').textContent;
            alert(`í˜„ì¬ íƒ­: ${currentTab}\n\níƒ­ ì „í™˜ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.`);
            
            if (currentTab === 'ë¡œê·¸ì¸') {
                showPanel('signup');
                setTimeout(() => {
                    showPanel('login');
                    alert("íƒ­ ì „í™˜ í…ŒìŠ¤íŠ¸ ì™„ë£Œ!");
                }, 1000);
            } else {
                showPanel('login');
                setTimeout(() => {
                    showPanel('signup');
                    alert("íƒ­ ì „í™˜ í…ŒìŠ¤íŠ¸ ì™„ë£Œ!");
                }, 1000);
            }
        }
        
        function showConsoleInfo() {
            console.log("=== ì‹œìŠ¤í…œ ì •ë³´ ===");
            console.log("í˜ì´ì§€ ì œëª©:", document.title);
            console.log("Firebase ê°ì²´:", typeof firebase);
            console.log("Firebase ë‚´ìš©:", firebase);
            console.log("ëª¨ë“  ì „ì—­ ë³€ìˆ˜:", Object.keys(window).filter(k => !k.startsWith('_') && k !== 'window'));
            
            alert("ì‹œìŠ¤í…œ ì •ë³´ê°€ ì½˜ì†”ì— ì¶œë ¥ë˜ì—ˆìŠµë‹ˆë‹¤.\nF12ë¥¼ ëˆŒëŸ¬ í™•ì¸í•˜ì„¸ìš”.");
        }
        
        // ====== ì´ˆê¸°í™” ======
        console.log("=== ì‹œìŠ¤í…œ ì´ˆê¸°í™” ===");
        console.log("1. firebase ê°ì²´:", typeof firebase);
        console.log("2. firebase ë‚´ìš©:", firebase);
        console.log("3. í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ");
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ í…ŒìŠ¤íŠ¸
        window.onload = function() {
            console.log("4. window.onload ì‹¤í–‰");
            
            if (typeof firebase !== 'undefined') {
                console.log("âœ… Firebase ê°ì²´ ë¡œë“œ ì„±ê³µ");
                console.log("Firebase apps:", firebase.apps.length);
            } else {
                console.error("âŒ Firebase ê°ì²´ ë¡œë“œ ì‹¤íŒ¨");
                
                // ìµœí›„ì˜ ìˆ˜ë‹¨: ì§ì ‘ ìƒì„±
                if (!window.firebase) {
                    window.firebase = { apps: [], _emergency: true };
                    console.log("âš ï¸ ê¸´ê¸‰ Firebase ê°ì²´ ìƒì„±");
                }
            }
            
            console.log("5. ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ");
        };
        
        // ì—”í„° í‚¤ ì§€ì›
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const activePanel = document.querySelector('.panel.active').id;
                if (activePanel === 'login-panel') handleLogin();
                if (activePanel === 'signup-panel') handleSignup();
            }
        });
    </script>
</body>
</html>
