<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A-Shop - 관리자 대시보드</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* admin.html에 사용했던 기존 CSS 스타일들 그대로 유지 */
        /* ... (이전에 작성했던 모든 CSS 코드) ... */
    </style>
</head>
<body>
    <!-- 기존 admin.html의 내용 전체 그대로 유지 -->
    <!-- ... (이전에 작성했던 모든 HTML 코드) ... -->

    <!-- 데이터 내보내기 버튼 추가 (기존 코드에 추가) -->
    <script>
        // 데이터 내보내기 기능
        async function exportToCSV() {
            try {
                // Firestore에서 데이터 가져오기
                const querySnapshot = await db.collection('ashop_users').get();
                const users = [];
                
                querySnapshot.forEach((doc) => {
                    users.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                
                // CSV 변환
                const csvContent = convertToCSV(users);
                
                // 파일 다운로드
                downloadCSV(csvContent, 'ashop_users.csv');
                
                alert('✅ CSV 파일이 다운로드되었습니다.');
            } catch (error) {
                console.error('Export error:', error);
                alert('❌ 내보내기 중 오류가 발생했습니다.');
            }
        }
        
        function convertToCSV(users) {
            const headers = ['이름', '이메일', '전화번호', '등급', '포인트', '상태', '가입일'];
            const rows = users.map(user => [
                user.displayName,
                user.email,
                user.phone,
                user.tier,
                user.points,
                user.status,
                new Date(user.createdAt).toLocaleDateString('ko-KR')
            ]);
            
            return [headers, ...rows]
                .map(row => row.map(cell => `"${cell}"`).join(','))
                .join('\n');
        }
        
        function downloadCSV(content, filename) {
            const blob = new Blob(['\uFEFF' + content], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // 관리자 페이지에 데이터 내보내기 버튼 추가
        document.addEventListener('DOMContentLoaded', function() {
            // 기존 코드...
            
            // 데이터 내보내기 버튼 생성
            const exportBtn = document.createElement('button');
            exportBtn.className = 'btn btn-success';
            exportBtn.innerHTML = '<i class="fas fa-download me-2"></i>CSV 내보내기';
            exportBtn.onclick = exportToCSV;
            
            // 적절한 위치에 버튼 추가 (예: 헤더 영역)
            const header = document.querySelector('.dashboard-header .container .row');
            if (header) {
                header.querySelector('.col-md-4').appendChild(exportBtn);
            }
        });
    </script>
</body>
</html>
