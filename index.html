<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¡œê·¸ì¸ | íšŒì›ê°€ì… - ashop</title>
    
    <!-- Firebase SDK v9 (í˜¸í™˜ì„± ëª¨ë“œ) -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    
    <style>
        /* ë¬´ì±„ìƒ‰ ë””ìì¸ ì‹œìŠ¤í…œ */
        :root {
            --white: #ffffff;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            --primary: #3b82f6;
            --primary-hover: #2563eb;
            --success: #10b981;
            --danger: #ef4444;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, var(--gray-100) 0%, var(--gray-200) 100%);
            color: var(--gray-800);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .auth-container {
            width: 100%;
            max-width: 480px;
            background: var(--white);
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            animation: fadeIn 0.5s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .tabs {
            display: flex;
            background: var(--gray-50);
            border-bottom: 1px solid var(--gray-200);
        }
        
        .tab-button {
            flex: 1;
            padding: 20px 0;
            background: none;
            border: none;
            font-size: 17px;
            font-weight: 500;
            color: var(--gray-600);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .tab-button:hover {
            color: var(--gray-800);
            background: var(--gray-100);
        }
        
        .tab-button.active {
            color: var(--primary);
            font-weight: 600;
        }
        
        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 25%;
            right: 25%;
            height: 3px;
            background: var(--primary);
            border-radius: 3px 3px 0 0;
        }
        
        .form-panel {
            padding: 40px;
            display: none;
        }
        
        .form-panel.active {
            display: block;
            animation: slideIn 0.4s ease-out;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(10px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .form-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 32px;
            text-align: center;
        }
        
        .form-subtitle {
            font-size: 14px;
            color: var(--gray-500);
            text-align: center;
            margin-bottom: 32px;
        }
        
        .input-group {
            margin-bottom: 22px;
        }
        
        .input-label {
            display: block;
            font-size: 15px;
            font-weight: 500;
            color: var(--gray-700);
            margin-bottom: 8px;
        }
        
        .input-label.required::after {
            content: ' *';
            color: var(--danger);
        }
        
        .input-field {
            width: 100%;
            padding: 14px 16px;
            font-size: 15px;
            border: 2px solid var(--gray-300);
            border-radius: 10px;
            background: var(--white);
            color: var(--gray-800);
            transition: all 0.3s ease;
        }
        
        .input-field:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .input-field.error {
            border-color: var(--danger);
        }
        
        .input-field.success {
            border-color: var(--success);
        }
        
        .input-field::placeholder {
            color: var(--gray-400);
        }
        
        .field-note {
            display: block;
            font-size: 13px;
            color: var(--gray-500);
            margin-top: 6px;
            line-height: 1.4;
        }
        
        .field-error {
            display: block;
            font-size: 13px;
            color: var(--danger);
            margin-top: 6px;
            display: none;
        }
        
        .submit-button {
            width: 100%;
            padding: 16px;
            background: var(--primary);
            color: var(--white);
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }
        
        .submit-button:hover {
            background: var(--primary-hover);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        
        .submit-button:active {
            transform: translateY(0);
        }
        
        .submit-button.loading {
            opacity: 0.7;
            cursor: not-allowed;
        }
        
        .divider {
            display: flex;
            align-items: center;
            margin: 32px 0;
            color: var(--gray-400);
            font-size: 14px;
        }
        
        .divider::before,
        .divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--gray-200);
        }
        
        .divider span {
            padding: 0 16px;
            background: var(--white);
        }
        
        .links {
            text-align: center;
            margin-top: 28px;
            font-size: 14px;
            color: var(--gray-600);
        }
        
        .links a {
            color: var(--primary);
            text-decoration: none;
            margin: 0 12px;
            transition: color 0.3s ease;
            font-weight: 500;
        }
        
        .links a:hover {
            color: var(--primary-hover);
            text-decoration: underline;
        }
        
        .checkbox-group {
            margin-bottom: 20px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 14px;
        }
        
        .checkbox-input {
            margin-top: 3px;
            margin-right: 14px;
            width: 20px;
            height: 20px;
            accent-color: var(--primary);
            cursor: pointer;
        }
        
        .checkbox-label {
            font-size: 15px;
            color: var(--gray-700);
            line-height: 1.5;
            cursor: pointer;
        }
        
        .checkbox-label a {
            color: var(--primary);
            text-decoration: none;
        }
        
        .checkbox-label a:hover {
            text-decoration: underline;
        }
        
        .checkbox-label strong {
            font-weight: 600;
            color: var(--gray-900);
        }
        
        .terms-section {
            background: var(--gray-50);
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            padding: 24px;
            margin: 28px 0;
            max-height: 240px;
            overflow-y: auto;
        }
        
        .terms-title {
            font-size: 17px;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 18px;
        }
        
        hr {
            border: none;
            height: 1px;
            background: var(--gray-200);
            margin: 18px 0;
        }
        
        /* GitHub ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .github-btn {
            background: var(--gray-900) !important;
        }
        
        .github-btn:hover {
            background: var(--gray-800) !important;
        }
        
        .github-btn img {
            filter: brightness(0) invert(1);
            width: 20px;
            height: 20px;
        }
        
        /* ìƒíƒœ ë©”ì‹œì§€ */
        .status-message {
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            display: none;
        }
        
        .status-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
            display: block;
        }
        
        .status-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
            display: block;
        }
        
        .status-info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #bfdbfe;
            display: block;
        }
        
        /* ë¡œë”© ìŠ¤í”¼ë„ˆ */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: var(--white);
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
            vertical-align: middle;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* í…ŒìŠ¤íŠ¸ ì˜ì—­ */
        .test-section {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border: 2px solid var(--primary);
            border-radius: 12px;
            padding: 20px;
            margin-top: 30px;
            text-align: center;
        }
        
        .test-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: 12px;
        }
        
        .test-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        .test-button {
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .test-firestore {
            background: var(--success);
            color: white;
        }
        
        .test-firestore:hover {
            background: #0da271;
        }
        
        .test-clear {
            background: var(--gray-300);
            color: var(--gray-700);
        }
        
        .test-clear:hover {
            background: var(--gray-400);
        }
        
        @media (max-width: 480px) {
            .auth-container {
                border-radius: 12px;
            }
            
            .form-panel {
                padding: 24px;
            }
            
            .tab-button {
                font-size: 16px;
                padding: 16px 0;
            }
            
            .form-title {
                font-size: 22px;
            }
            
            .test-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="auth-container">
        <!-- íƒ­ ë©”ë‰´ -->
        <div class="tabs">
            <button class="tab-button active" onclick="showTab('login')">ë¡œê·¸ì¸</button>
            <button class="tab-button" onclick="showTab('signup')">íšŒì›ê°€ì…</button>
        </div>
        
        <!-- ë¡œê·¸ì¸ í¼ -->
        <div id="login-form" class="form-panel active">
            <h2 class="form-title">ashop ë¡œê·¸ì¸</h2>
            <p class="form-subtitle">ê³„ì •ì´ ì—†ìœ¼ì‹œë‹¤ë©´ íšŒì›ê°€ì…ì„ ì§„í–‰í•´ì£¼ì„¸ìš”</p>
            
            <!-- ìƒíƒœ ë©”ì‹œì§€ -->
            <div id="login-status" class="status-message"></div>
            
            <div class="input-group">
                <label class="input-label required" for="email">ì´ë©”ì¼</label>
                <input type="email" id="email" class="input-field" placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”">
                <div class="field-error" id="email-error"></div>
            </div>
            
            <div class="input-group">
                <label class="input-label required" for="password">ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" id="password" class="input-field" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                <div class="field-error" id="password-error"></div>
            </div>
            
            <button class="submit-button" onclick="handleLogin()" id="login-btn">
                ë¡œê·¸ì¸
            </button>
            
            <!-- GitHub ë¡œê·¸ì¸ ë²„íŠ¼ -->
            <div class="input-group">
                <div class="divider">
                    <span>ì†Œì…œ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸</span>
                </div>
                
                <button id="github-login-btn" class="submit-button github-btn" onclick="handleGitHubLogin()">
                    <img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" alt="GitHub">
                    GitHubìœ¼ë¡œ ë¡œê·¸ì¸
                </button>
            </div>
            
            <div class="links">
                <a href="#" onclick="forgotPassword()">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</a>
                <a href="#" onclick="showTab('signup')">íšŒì›ê°€ì…</a>
            </div>
            
            <!-- Firestore í…ŒìŠ¤íŠ¸ ì˜ì—­ -->
            <div class="test-section">
                <div class="test-title">ì‹œìŠ¤í…œ ì—°ê²° í…ŒìŠ¤íŠ¸</div>
                <div class="test-buttons">
                    <button class="test-button test-firestore" onclick="testFirestoreConnection()">
                        ğŸ” Firestore ì—°ê²° í…ŒìŠ¤íŠ¸
                    </button>
                    <button class="test-button test-clear" onclick="clearForm('login')">
                        âœ¨ í¼ ì´ˆê¸°í™”
                    </button>
                </div>
            </div>
        </div>
        
        <!-- íšŒì›ê°€ì… í¼ -->
        <div id="signup-form" class="form-panel">
            <h2 class="form-title">ashop íšŒì›ê°€ì…</h2>
            <p class="form-subtitle">ë¹ ë¥´ê³  ê°„í¸í•œ íšŒì›ê°€ì…ìœ¼ë¡œ ë‹¤ì–‘í•œ í˜œíƒì„ ëˆ„ë ¤ë³´ì„¸ìš”</p>
            
            <!-- ìƒíƒœ ë©”ì‹œì§€ -->
            <div id="signup-status" class="status-message"></div>
            
            <div class="input-group">
                <label class="input-label required" for="signup-email">ì´ë©”ì¼</label>
                <input type="email" id="signup-email" class="input-field" placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”">
                <div class="field-error" id="signup-email-error"></div>
            </div>
            
            <div class="input-group">
                <label class="input-label required" for="username">ì´ë¦„</label>
                <input type="text" id="username" class="input-field" placeholder="ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”">
                <div class="field-error" id="username-error"></div>
            </div>
            
            <div class="input-group">
                <label class="input-label" for="phone">í•¸ë“œí° ë²ˆí˜¸</label>
                <input type="tel" id="phone" class="input-field" placeholder="ì˜ˆ) 010-1234-5678">
                <span class="field-note">í•˜ì´í”ˆ(-)ì„ í¬í•¨í•˜ì—¬ ì…ë ¥í•´ì£¼ì„¸ìš”</span>
                <div class="field-error" id="phone-error"></div>
            </div>
            
            <div class="input-group">
                <label class="input-label required" for="signup-password">ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" id="signup-password" class="input-field" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”">
                <span class="field-note">ì˜ë¬¸, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ìë¥¼ í¬í•¨í•œ 8ì ì´ìƒ</span>
                <div class="field-error" id="signup-password-error"></div>
            </div>
            
            <div class="input-group">
                <label class="input-label required" for="confirm-password">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
                <input type="password" id="confirm-password" class="input-field" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì…ë ¥í•´ì£¼ì„¸ìš”">
                <div class="field-error" id="confirm-password-error"></div>
            </div>
            
            <!-- ì•½ê´€ ë™ì˜ -->
            <div class="terms-section">
                <div class="terms-title">ì•½ê´€ ë™ì˜</div>
                
                <div class="checkbox-item">
                    <input type="checkbox" id="terms-all" class="checkbox-input" onclick="toggleAllTerms()">
                    <label for="terms-all" class="checkbox-label"><strong>ëª¨ë“  ì•½ê´€ì— ë™ì˜í•©ë‹ˆë‹¤</strong></label>
                </div>
                
                <hr>
                
                <div class="checkbox-item">
                    <input type="checkbox" id="terms-age" class="checkbox-input term" required>
                    <label for="terms-age" class="checkbox-label">ë§Œ 14ì„¸ ì´ìƒì…ë‹ˆë‹¤. (í•„ìˆ˜)</label>
                </div>
                
                <div class="checkbox-item">
                    <input type="checkbox" id="terms-service" class="checkbox-input term" required>
                    <label for="terms-service" class="checkbox-label">ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€ ë™ì˜ (í•„ìˆ˜) <a href="#" onclick="showTerms('service')">ë³´ê¸°</a></label>
                </div>
                
                <div class="checkbox-item">
                    <input type="checkbox" id="terms-privacy" class="checkbox-input term" required>
                    <label for="terms-privacy" class="checkbox-label">ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš© ë™ì˜ (í•„ìˆ˜) <a href="#" onclick="showTerms('privacy')">ë³´ê¸°</a></label>
                </div>
                
                <div class="checkbox-item">
                    <input type="checkbox" id="terms-marketing" class="checkbox-input term">
                    <label for="terms-marketing" class="checkbox-label">ì´ë²¤íŠ¸ ë° SMS ë§ˆì¼€íŒ… ì •ë³´ ìˆ˜ì‹  ë™ì˜ (ì„ íƒ)</label>
                </div>
            </div>
            
            <button class="submit-button" onclick="handleSignup()" id="signup-btn">
                íšŒì›ê°€ì…
            </button>
            
            <!-- GitHub íšŒì›ê°€ì… ë²„íŠ¼ -->
            <div class="input-group">
                <div class="divider">
                    <span>ì†Œì…œ ê³„ì •ìœ¼ë¡œ ê°€ì…</span>
                </div>
                
                <button id="github-signup-btn" class="submit-button github-btn" onclick="handleGitHubSignup()">
                    <img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" alt="GitHub">
                    GitHubìœ¼ë¡œ íšŒì›ê°€ì…
                </button>
            </div>
            
            <div class="links">
                ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? <a href="#" onclick="showTab('login')">ë¡œê·¸ì¸</a>
            </div>
        </div>
    </div>

    <script>
        // ========== Firebase ì„¤ì • ==========
        const firebaseConfig = {
            apiKey: "AIzaSyC1XDqgki7lKMz-EE4ZFzOLmku8EsLI0yI",
            authDomain: "login-57c14.firebaseapp.com",
            projectId: "login-57c14",
            storageBucket: "login-57c14.firebasestorage.app",
            messagingSenderId: "847658526472",
            appId: "1:847658526472:web:05adaddfea3afff8e12ebd"
        };

        console.log("ğŸ”¥ ashop Firebase ì„¤ì • ë¡œë“œë¨");

        // ========== Firebase ì´ˆê¸°í™” ==========
        let auth = null;
        let db = null;
        
        try {
            firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            db = firebase.firestore();
            
            console.log("âœ… Firebase ì´ˆê¸°í™” ì„±ê³µ");
            console.log("í”„ë¡œì íŠ¸ ID:", firebase.app().options.projectId);
            console.log("Firestore ì¤€ë¹„ë¨:", !!db);
            
            // ì´ˆê¸° ìƒíƒœ ë©”ì‹œì§€
            showStatus('login', 'Firebase ì—°ê²°ì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            
        } catch (error) {
            console.error("âŒ Firebase ì´ˆê¸°í™” ì‹¤íŒ¨:", error);
            showStatus('login', 'Firebase ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.', 'error');
        }

        // ========== ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜ ==========
        function showStatus(form, message, type = 'info') {
            const statusEl = document.getElementById(`${form}-status`);
            statusEl.textContent = message;
            statusEl.className = `status-message status-${type}`;
            
            if (type === 'error' || type === 'success') {
                setTimeout(() => {
                    statusEl.style.display = 'none';
                }, 5000);
            }
        }

        // ========== ë¡œë”© ìƒíƒœ ê´€ë¦¬ ==========
        function setLoading(buttonId, isLoading) {
            const button = document.getElementById(buttonId);
            if (!button) return;
            
            if (isLoading) {
                button.classList.add('loading');
                button.innerHTML = '<span class="spinner"></span>ì²˜ë¦¬ ì¤‘...';
                button.disabled = true;
            } else {
                button.classList.remove('loading');
                button.innerHTML = buttonId === 'login-btn' ? 'ë¡œê·¸ì¸' : 'íšŒì›ê°€ì…';
                button.disabled = false;
            }
        }

        // ========== ìœ íš¨ì„± ê²€ì‚¬ í•¨ìˆ˜ ==========
        function validateEmail(email) {
            const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return regex.test(email);
        }

        function validatePassword(password) {
            return password.length >= 8;
        }

        function validatePhone(phone) {
            if (!phone) return true; // ì„ íƒì‚¬í•­
            const regex = /^\d{3}-\d{3,4}-\d{4}$/;
            return regex.test(phone);
        }

        // ========== ì´ë©”ì¼ ë¡œê·¸ì¸ í•¨ìˆ˜ ==========
        async function handleLogin() {
            console.log("ğŸ” ì´ë©”ì¼ ë¡œê·¸ì¸ ì‹œì‘");
            
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value;
            
            // ìœ íš¨ì„± ê²€ì‚¬
            if (!email) {
                showError('email', 'ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!validateEmail(email)) {
                showError('email', 'ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.');
                return;
            }
            
            if (!password) {
                showError('password', 'ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ì—ëŸ¬ ë©”ì‹œì§€ ì´ˆê¸°í™”
            clearErrors(['email', 'password']);
            setLoading('login-btn', true);
            
            try {
                console.log('ë¡œê·¸ì¸ ì‹œë„:', email);
                
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                console.log('âœ… ë¡œê·¸ì¸ ì„±ê³µ:', user.uid);
                
                // Firestoreì— ë¡œê·¸ì¸ ì‹œê°„ ì—…ë°ì´íŠ¸
                if (db) {
                    await updateLastLogin(user.uid);
                }
                
                // ì„±ê³µ ë©”ì‹œì§€
                showStatus('login', `${user.email}ë‹˜, í™˜ì˜í•©ë‹ˆë‹¤!`, 'success');
                
                // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                document.getElementById('email').value = '';
                document.getElementById('password').value = '';
                
                // 2ì´ˆ í›„ ëŒ€ì‹œë³´ë“œë¡œ ì´ë™ (ê°œë°œ ì¤‘ì´ë¯€ë¡œ ì£¼ì„ì²˜ë¦¬)
                // setTimeout(() => {
                //     window.location.href = '/dashboard.html';
                // }, 2000);
                
                alert(`ë¡œê·¸ì¸ ì„±ê³µ!\ní™˜ì˜í•©ë‹ˆë‹¤, ${user.email}ë‹˜!`);
                
            } catch (error) {
                console.error('âŒ ë¡œê·¸ì¸ ì‹¤íŒ¨:', error);
                
                let errorMessage = 'ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
                
                switch(error.code) {
                    case 'auth/user-not-found':
                        errorMessage = 'ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì´ë©”ì¼ì…ë‹ˆë‹¤.';
                        showError('email', errorMessage);
                        break;
                    case 'auth/wrong-password':
                        errorMessage = 'ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.';
                        showError('password', errorMessage);
                        break;
                    case 'auth/invalid-email':
                        errorMessage = 'ìœ íš¨í•˜ì§€ ì•Šì€ ì´ë©”ì¼ í˜•ì‹ì…ë‹ˆë‹¤.';
                        showError('email', errorMessage);
                        break;
                    case 'auth/user-disabled':
                        errorMessage = 'ì‚¬ìš©ì´ ì¤‘ì§€ëœ ê³„ì •ì…ë‹ˆë‹¤.';
                        showError('email', errorMessage);
                        break;
                    case 'auth/too-many-requests':
                        errorMessage = 'ë„ˆë¬´ ë§ì€ ì‹œë„ê°€ ìˆì—ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                        showStatus('login', errorMessage, 'error');
                        break;
                    default:
                        showStatus('login', errorMessage, 'error');
                }
                
            } finally {
                setLoading('login-btn', false);
            }
        }

        // ========== ì´ë©”ì¼ íšŒì›ê°€ì… í•¨ìˆ˜ ==========
        async function handleSignup() {
            console.log("ğŸ“ ì´ë©”ì¼ íšŒì›ê°€ì… ì‹œì‘");
            
            // ì…ë ¥ê°’ ê°€ì ¸ì˜¤ê¸°
            const email = document.getElementById('signup-email').value.trim();
            const username = document.getElementById('username').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const password = document.getElementById('signup-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            
            // ìœ íš¨ì„± ê²€ì‚¬
            let hasError = false;
            
            if (!email) {
                showError('signup-email', 'ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                hasError = true;
            } else if (!validateEmail(email)) {
                showError('signup-email', 'ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.');
                hasError = true;
            }
            
            if (!username) {
                showError('username', 'ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                hasError = true;
            }
            
            if (!validatePhone(phone)) {
                showError('phone', 'ì˜¬ë°”ë¥¸ í•¸ë“œí° ë²ˆí˜¸ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤. (ì˜ˆ: 010-1234-5678)');
                hasError = true;
            }
            
            if (!password) {
                showError('signup-password', 'ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                hasError = true;
            } else if (!validatePassword(password)) {
                showError('signup-password', 'ë¹„ë°€ë²ˆí˜¸ëŠ” 8ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
                hasError = true;
            }
            
            if (!confirmPassword) {
                showError('confirm-password', 'ë¹„ë°€ë²ˆí˜¸ í™•ì¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                hasError = true;
            } else if (password !== confirmPassword) {
                showError('confirm-password', 'ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                hasError = true;
            }
            
            // ì•½ê´€ ë™ì˜ í™•ì¸
            if (!document.getElementById('terms-age').checked || 
                !document.getElementById('terms-service').checked || 
                !document.getElementById('terms-privacy').checked) {
                showStatus('signup', 'í•„ìˆ˜ ì•½ê´€ì— ëª¨ë‘ ë™ì˜í•´ì£¼ì„¸ìš”.', 'error');
                hasError = true;
            }
            
            if (hasError) return;
            
            // ì—ëŸ¬ ë©”ì‹œì§€ ì´ˆê¸°í™”
            clearErrors(['signup-email', 'username', 'phone', 'signup-password', 'confirm-password']);
            setLoading('signup-btn', true);
            
            // ë§ˆì¼€íŒ… ë™ì˜ ì—¬ë¶€
            const marketingAgreed = {
                email: document.getElementById('terms-marketing')?.checked || false,
                sms: false
            };
            
            try {
                console.log('íšŒì›ê°€ì… ì‹œë„:', email);
                
                // 1. Firebase Authenticationì— ì‚¬ìš©ì ìƒì„±
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                console.log('âœ… Firebase Auth ìƒì„± ì„±ê³µ:', user.uid);
                
                // 2. Firestoreì— ì‚¬ìš©ì ë°ì´í„° ì €ì¥
                const userData = {
                    uid: user.uid,
                    email: email,
                    username: username,
                    phone: phone || '',
                    displayName: username,
                    tier: 'bronze',
                    points: 1000,
                    status: 'active',
                    signupMethod: 'email',
                    emailVerified: false,
                    marketingAgreed: marketingAgreed,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                    lastLogin: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                await db.collection('ashop_users').doc(user.uid).set(userData);
                console.log('âœ… Firestore ì €ì¥ ì™„ë£Œ');
                
                // 3. ì´ë©”ì¼ ì¸ì¦ ë©”ì¼ ë°œì†¡
                await user.sendEmailVerification();
                console.log('ğŸ“§ ì´ë©”ì¼ ì¸ì¦ ë©”ì¼ ë°œì†¡ë¨');
                
                // 4. ì„±ê³µ ì²˜ë¦¬
                showStatus('signup', 
                    `ğŸ‰ ${username}ë‹˜, íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\nê°€ì… ì¶•í•˜ í¬ì¸íŠ¸ 1,000ì ì´ ì§€ê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤.\nì´ë©”ì¼ ì¸ì¦ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”.`, 
                    'success'
                );
                
                // 5. ì…ë ¥ í¼ ì´ˆê¸°í™”
                clearForm('signup');
                
                // 6. 3ì´ˆ í›„ ë¡œê·¸ì¸ íƒ­ìœ¼ë¡œ ì „í™˜
                setTimeout(() => {
                    showTab('login');
                    document.getElementById('email').value = email;
                    showStatus('login', `${username}ë‹˜, ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”!`, 'success');
                }, 3000);
                
            } catch (error) {
                console.error('âŒ íšŒì›ê°€ì… ì‹¤íŒ¨:', error);
                
                let errorMessage = 'íšŒì›ê°€ì…ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
                
                switch(error.code) {
                    case 'auth/email-already-in-use':
                        errorMessage = 'ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì´ë©”ì¼ì…ë‹ˆë‹¤.';
                        showError('signup-email', errorMessage);
                        break;
                    case 'auth/weak-password':
                        errorMessage = 'ë¹„ë°€ë²ˆí˜¸ê°€ ë„ˆë¬´ ì•½í•©ë‹ˆë‹¤. ë” ê°•ë ¥í•œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš”.';
                        showError('signup-password', errorMessage);
                        break;
                    case 'auth/invalid-email':
                        errorMessage = 'ìœ íš¨í•˜ì§€ ì•Šì€ ì´ë©”ì¼ í˜•ì‹ì…ë‹ˆë‹¤.';
                        showError('signup-email', errorMessage);
                        break;
                    case 'auth/operation-not-allowed':
                        errorMessage = 'ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ íšŒì›ê°€ì…ì´ ë¹„í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.';
                        showStatus('signup', errorMessage, 'error');
                        break;
                    case 'permission-denied':
                        errorMessage = 'ë°ì´í„°ë² ì´ìŠ¤ ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.';
                        showStatus('signup', errorMessage, 'error');
                        break;
                    default:
                        showStatus('signup', errorMessage, 'error');
                }
                
            } finally {
                setLoading('signup-btn', false);
            }
        }

        // ========== GitHub ë¡œê·¸ì¸ í•¨ìˆ˜ ==========
        async function handleGitHubLogin() {
            if (!auth || !db) {
                alert('Firebaseê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            try {
                const provider = new firebase.auth.GithubAuthProvider();
                provider.addScope('user:email');
                
                console.log('GitHub ë¡œê·¸ì¸ ì‹œë„...');
                
                const result = await auth.signInWithPopup(provider);
                const user = result.user;
                
                console.log('âœ… GitHub ë¡œê·¸ì¸ ì„±ê³µ:', user.uid);
                
                // Firestoreì— ì‚¬ìš©ì ë°ì´í„° ì €ì¥/ì—…ë°ì´íŠ¸
                const userData = {
                    uid: user.uid,
                    email: user.email,
                    username: user.displayName || user.email.split('@')[0],
                    displayName: user.displayName,
                    photoURL: user.photoURL,
                    tier: 'bronze',
                    points: 1000,
                    status: 'active',
                    signupMethod: 'github',
                    emailVerified: user.emailVerified,
                    provider: 'github',
                    githubId: user.providerData[0]?.uid,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                    lastLogin: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                const userRef = db.collection('ashop_users').doc(user.uid);
                const userDoc = await userRef.get();
                
                if (!userDoc.exists) {
                    await userRef.set(userData);
                    console.log('ì‹ ê·œ GitHub ì‚¬ìš©ì ë°ì´í„° ì €ì¥');
                } else {
                    await userRef.update({
                        lastLogin: userData.lastLogin,
                        updatedAt: userData.updatedAt
                    });
                    console.log('ê¸°ì¡´ GitHub ì‚¬ìš©ì ì—…ë°ì´íŠ¸');
                }
                
                alert(`GitHub ë¡œê·¸ì¸ ì„±ê³µ!\ní™˜ì˜í•©ë‹ˆë‹¤, ${user.displayName || user.email}ë‹˜!`);
                
                // ëŒ€ì‹œë³´ë“œë¡œ ì´ë™ (ê°œë°œ ì¤‘ì´ë¯€ë¡œ ì£¼ì„ì²˜ë¦¬)
                // window.location.href = '/dashboard.html';
                
            } catch (error) {
                console.error('âŒ GitHub ë¡œê·¸ì¸ ì‹¤íŒ¨:', error);
                
                let errorMessage = 'GitHub ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
                
                if (error.code === 'auth/popup-blocked') {
                    errorMessage = 'íŒì—…ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ íŒì—…ì„ í—ˆìš©í•´ì£¼ì„¸ìš”.';
                } else if (error.code === 'auth/popup-closed-by-user') {
                    errorMessage = 'ë¡œê·¸ì¸ ì°½ì´ ë‹«í˜”ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                } else if (error.code === 'auth/network-request-failed') {
                    errorMessage = 'ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.';
                }
                
                alert(errorMessage);
            }
        }

        // ========== ë³´ì¡° í•¨ìˆ˜ë“¤ ==========
        function showError(fieldId, message) {
            const errorEl = document.getElementById(`${fieldId}-error`);
            if (errorEl) {
                errorEl.textContent = message;
                errorEl.style.display = 'block';
                document.getElementById(fieldId).classList.add('error');
            }
        }

        function clearErrors(fieldIds) {
            fieldIds.forEach(fieldId => {
                const errorEl = document.getElementById(`${fieldId}-error`);
                if (errorEl) {
                    errorEl.style.display = 'none';
                    document.getElementById(fieldId).classList.remove('error');
                }
            });
        }

        function clearForm(formType) {
            if (formType === 'login') {
                document.getElementById('email').value = '';
                document.getElementById('password').value = '';
                clearErrors(['email', 'password']);
                document.getElementById('login-status').style.display = 'none';
            } else if (formType === 'signup') {
                document.getElementById('signup-email').value = '';
                document.getElementById('username').value = '';
                document.getElementById('phone').value = '';
                document.getElementById('signup-password').value = '';
                document.getElementById('confirm-password').value = '';
                document.getElementById('terms-all').checked = false;
                document.querySelectorAll('.term').forEach(term => term.checked = false);
                clearErrors(['signup-email', 'username', 'phone', 'signup-password', 'confirm-password']);
                document.getElementById('signup-status').style.display = 'none';
            }
        }

        async function updateLastLogin(uid) {
            try {
                await db.collection('ashop_users').doc(uid).update({
                    lastLogin: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
            } catch (error) {
                console.error('ë¡œê·¸ì¸ ì‹œê°„ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
            }
        }

        // ========== í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ ==========
        async function testFirestoreConnection() {
            if (!db) {
                alert('Firestoreê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return;
            }
            
            try {
                // í…ŒìŠ¤íŠ¸ ë¬¸ì„œ ì¡°íšŒ
                const testDoc = await db.collection('ashop_users').doc('test_user_001').get();
                
                if (testDoc.exists) {
                    const data = testDoc.data();
                    alert(`âœ… Firestore ì—°ê²° ì„±ê³µ!\n\ní…ŒìŠ¤íŠ¸ ì‚¬ìš©ì ì •ë³´:\nì´ë¦„: ${data.name}\nì´ë©”ì¼: ${data.ì´ë©”ì¼ || data.email}\nê°€ì…ì¼: ${data.createdAt?.toDate?.().toLocaleDateString() || 'ì—†ìŒ'}`);
                } else {
                    alert('âš ï¸ Firestore ì—°ê²°ì€ ì„±ê³µí–ˆì§€ë§Œ í…ŒìŠ¤íŠ¸ ë¬¸ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\nFirebase ì½˜ì†”ì—ì„œ test_user_001 ë¬¸ì„œë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
                }
            } catch (error) {
                alert(`âŒ Firestore ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨:\n${error.message}`);
            }
        }

        // ========== ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • í•¨ìˆ˜ ==========
        async function forgotPassword() {
            const email = prompt('ë¹„ë°€ë²ˆí˜¸ë¥¼ ì¬ì„¤ì •í•  ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”:');
            
            if (!email) return;
            
            if (!validateEmail(email)) {
                alert('ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            try {
                await auth.sendPasswordResetEmail(email);
                alert(`ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ë©”ì¼ì„ ${email}ë¡œ ë°œì†¡í–ˆìŠµë‹ˆë‹¤.\nì´ë©”ì¼ì„ í™•ì¸í•´ì£¼ì„¸ìš”.`);
            } catch (error) {
                console.error('ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ì‹¤íŒ¨:', error);
                alert('ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì´ë©”ì¼ ì£¼ì†Œë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
            }
        }

        // ========== UI í•¨ìˆ˜ë“¤ ==========
        function showTab(tabName) {
            // íƒ­ ë²„íŠ¼ í™œì„±í™”
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`button[onclick="showTab('${tabName}')"]`).classList.add('active');
            
            // í¼ íŒ¨ë„ í™œì„±í™”
            document.querySelectorAll('.form-panel').forEach(panel => {
                panel.classList.remove('active');
            });
            document.getElementById(`${tabName}-form`).classList.add('active');
            
            // ìƒíƒœ ë©”ì‹œì§€ ì´ˆê¸°í™”
            document.getElementById(`${tabName === 'login' ? 'signup' : 'login'}-status`).style.display = 'none';
            
            // í¬ì»¤ìŠ¤ ì„¤ì •
            if (tabName === 'signup') {
                setTimeout(() => {
                    document.getElementById('signup-email').focus();
                }, 100);
            } else {
                setTimeout(() => {
                    document.getElementById('email').focus();
                }, 100);
            }
        }
        
        function toggleAllTerms() {
            const allCheckbox = document.getElementById('terms-all');
            const terms = document.querySelectorAll('.term');
            terms.forEach(term => {
                term.checked = allCheckbox.checked;
            });
        }
        
        function showTerms(type) {
            const terms = {
                service: 'ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€ ë‚´ìš©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...',
                privacy: 'ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš© ì•½ê´€ ë‚´ìš©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...'
            };
            alert(terms[type] || 'ì•½ê´€ ë‚´ìš©ì„ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.');
            return false; // ë§í¬ ê¸°ë³¸ ë™ì‘ ë°©ì§€
        }

        // GitHub íšŒì›ê°€ì…ì€ ë¡œê·¸ì¸ê³¼ ë™ì¼
        function handleGitHubSignup() {
            handleGitHubLogin();
        }

        // ========== ì¸ì¦ ìƒíƒœ ê°ì§€ ==========
        if (auth) {
            auth.onAuthStateChanged((user) => {
                if (user) {
                    console.log("ğŸ‘¤ ì‚¬ìš©ì ë¡œê·¸ì¸ ìƒíƒœ:", user.email);
                    // ë¡œê·¸ì¸ ìƒíƒœì— ë”°ë¥¸ UI ì—…ë°ì´íŠ¸
                    if (user.emailVerified) {
                        console.log("ì´ë©”ì¼ ì¸ì¦ ì™„ë£Œ");
                    }
                } else {
                    console.log("ğŸšª ì‚¬ìš©ì ë¡œê·¸ì•„ì›ƒ ìƒíƒœ");
                }
            });
        }

        // ========== í˜ì´ì§€ ì´ˆê¸°í™” ==========
        document.addEventListener('DOMContentLoaded', function() {
            console.log("ğŸ“„ ashop ë¡œê·¸ì¸ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ");
            console.log("Firebase ìƒíƒœ:", !!auth ? "ì¤€ë¹„ë¨" : "ì‹¤íŒ¨");
            console.log("Firestore ìƒíƒœ:", !!db ? "ì¤€ë¹„ë¨" : "ì‹¤íŒ¨");
            
            // ë¡œê·¸ì¸ í¼ ì´ë©”ì¼ í•„ë“œì— í¬ì»¤ìŠ¤
            document.getElementById('email').focus();
            
            // Firebase ì´ˆê¸°í™” ìƒíƒœ í‘œì‹œ
            if (auth && db) {
                console.log("âœ… ëª¨ë“  ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ");
            }
        });

        // ì—”í„° í‚¤ë¡œ í¼ ì œì¶œ
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const activePanel = document.querySelector('.form-panel.active');
                if (activePanel.id === 'login-form') {
                    handleLogin();
                } else if (activePanel.id === 'signup-form') {
                    handleSignup();
                }
            }
        });
    </script>
</body>
</html>
