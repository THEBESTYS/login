<!DOCTYPE html>
<html>
<head>
    <title>Firestore ë¡œì»¬ í…ŒìŠ¤íŠ¸</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        button { 
            padding: 15px 30px; 
            background: #4285f4; 
            color: white; 
            border: none; 
            border-radius: 8px; 
            font-size: 18px; 
            cursor: pointer; 
            margin: 20px 0; 
        }
        button:hover { background: #3367d6; }
        #result { 
            margin-top: 20px; 
            padding: 20px; 
            border-radius: 8px; 
            background: #f8f9fa; 
            border: 1px solid #ddd; 
        }
        .success { background: #d4edda; color: #155724; border-color: #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border-color: #f5c6cb; }
    </style>
</head>
<body>
    <h1>ğŸ”¥ Firestore ë¡œì»¬ í…ŒìŠ¤íŠ¸ í˜ì´ì§€</h1>
    <p>ì´ í˜ì´ì§€ëŠ” ë¡œì»¬ì—ì„œ Firestore ì—°ê²°ì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>
    
    <!-- ì´ ë²„íŠ¼ì´ ë³´ì—¬ì•¼ í•©ë‹ˆë‹¤! -->
    <button onclick="testFirestoreConnection()">
        ğŸ” Firestore ì—°ê²° í…ŒìŠ¤íŠ¸í•˜ê¸°
    </button>
    
    <div id="result">
        ì—¬ê¸°ì— í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤...
    </div>

    <script>
        // === 1. Firebase ì„¤ì • ===
        const firebaseConfig = {
            apiKey: "AIzaSyC1XDqgki7lKMz-EE4ZFzOLmku8EsLI0yI",
            authDomain: "login-57c14.firebaseapp.com",
            projectId: "login-57c14",
            storageBucket: "login-57c14.firebasestorage.app",
            messagingSenderId: "847658526472",
            appId: "1:847658526472:web:05adaddfea3afff8e12ebd"
        };

        // === 2. Firebase ì´ˆê¸°í™” ===
        let db;
        try {
            // Firebase ì•± ì´ˆê¸°í™”
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            
            // Firestore ì„¤ì •
            db.settings({
                timestampsInSnapshots: true
            });
            
            console.log("âœ… Firebase ì´ˆê¸°í™” ì„±ê³µ!");
            console.log("í”„ë¡œì íŠ¸ ID:", firebase.app().options.projectId);
            
            // í˜ì´ì§€ ìƒíƒœ ì—…ë°ì´íŠ¸
            document.getElementById('result').innerHTML = 
                '<p style="color: green;">âœ… Firebase SDK ë¡œë“œ ì™„ë£Œ. ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”!</p>';
                
        } catch (error) {
            console.error("âŒ Firebase ì´ˆê¸°í™” ì‹¤íŒ¨:", error);
            document.getElementById('result').innerHTML = 
                `<p style="color: red;">âŒ Firebase ì´ˆê¸°í™” ì‹¤íŒ¨: ${error.message}</p>`;
        }

        // === 3. í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ ===
        async function testFirestoreConnection() {
            const resultDiv = document.getElementById('result');
            
            if (!db) {
                resultDiv.innerHTML = '<p class="error">âŒ Firestoreê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            resultDiv.innerHTML = '<p>ğŸ”— Firestore ì—°ê²° ì‹œë„ ì¤‘...</p>';
            
            try {
                // Firestoreì—ì„œ ë¬¸ì„œ ë¶ˆëŸ¬ì˜¤ê¸°
                const docRef = db.collection('ashop_users').doc('test_user_001');
                const doc = await docRef.get();
                
                if (doc.exists) {
                    const data = doc.data();
                    
                    // ê²°ê³¼ í‘œì‹œ
                    resultDiv.innerHTML = `
                        <div class="success">
                            <h3>ğŸ‰ Firestore ì—°ê²° ì„±ê³µ!</h3>
                            <p><strong>ë¬¸ì„œ ID:</strong> ${doc.id}</p>
                            <p><strong>ì´ë¦„:</strong> ${data.name || 'ì—†ìŒ'}</p>
                            <p><strong>ì´ë©”ì¼:</strong> ${data.ì´ë©”ì¼ || data.email || 'ì—†ìŒ'}</p>
                            <p><strong>í•¸ë“œí°:</strong> ${data['í•¸ë“œí° ë²ˆí˜¸'] || data.phone || 'ì—†ìŒ'}</p>
                            <p><strong>ê°€ì…ì¼:</strong> ${data.ê°€ì…ì¼?.toDate?.().toLocaleString() || 'ì—†ìŒ'}</p>
                            <hr>
                            <p><small>ì „ì²´ ë°ì´í„°:</small></p>
                            <pre style="background: white; padding: 10px; border-radius: 5px; overflow: auto;">
${JSON.stringify(data, null, 2)}
                            </pre>
                        </div>
                    `;
                    
                    console.log("âœ… Firestore ë°ì´í„°:", data);
                    
                } else {
                    resultDiv.innerHTML = `
                        <div class="error">
                            <h3>âš ï¸ ë¬¸ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</h3>
                            <p>Firestoreì—ëŠ” ì—°ê²°ë˜ì—ˆì§€ë§Œ, test_user_001 ë¬¸ì„œê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                            <p>Firestore ì½˜ì†”ì—ì„œ ë¬¸ì„œê°€ ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.</p>
                        </div>
                    `;
                }
                
            } catch (error) {
                console.error("âŒ Firestore ì—ëŸ¬:", error);
                
                // ì—ëŸ¬ ì¢…ë¥˜ë³„ ë©”ì‹œì§€
                let errorMessage = error.message;
                if (error.code === 'permission-denied') {
                    errorMessage = "Firestore ë³´ì•ˆ ê·œì¹™ì— ì˜í•´ ì ‘ê·¼ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.";
                } else if (error.code === 'not-found') {
                    errorMessage = "í”„ë¡œì íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. Firebase ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš”.";
                }
                
                resultDiv.innerHTML = `
                    <div class="error">
                        <h3>âŒ Firestore ì—°ê²° ì‹¤íŒ¨</h3>
                        <p><strong>ì—ëŸ¬:</strong> ${errorMessage}</p>
                        <p><strong>ì½”ë“œ:</strong> ${error.code || 'ì•Œ ìˆ˜ ì—†ìŒ'}</p>
                        <p>1. ì¸í„°ë„· ì—°ê²° í™•ì¸<br>
                        2. Firebase í”„ë¡œì íŠ¸ í™•ì¸<br>
                        3. Firestore ë³´ì•ˆ ê·œì¹™ í™•ì¸</p>
                    </div>
                `;
            }
        }
        
        // === 4. í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ ë©”ì‹œì§€ ===
        window.addEventListener('load', function() {
            console.log("ğŸ”„ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ");
            console.log("Firebase ì‚¬ìš© ê°€ëŠ¥:", !!firebase.apps.length);
            console.log("Firestore ì‚¬ìš© ê°€ëŠ¥:", !!db);
        });
    </script>
</body>
</html>
